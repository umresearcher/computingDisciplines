<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Data Entry</title>
    <link rel="stylesheet" href="epiStyles.css">
    <style>
        .container {
            max-width: 600px;
            margin: auto;
        }

        .input-section,
        .table-section {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
        }

        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }

        button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table,
        th,
        td {
            border: 1px solid black;
        }

        th,
        td {
            padding: 10px;
            text-align: center;
        }

        input[type="text"] {
            width: 100%;
            padding: 5px;
            box-sizing: border-box;
        }

        #ratiosSection, #attrRiskResult, #PARResult {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }

        /* Container for the buttons */
        .button-container {
            display: flex;
            justify-content: space-around; /* Distribute space evenly */
            align-items: center; /* Center align items vertically */
            margin: 20px 0; /* Add some margin around the container */
        }

        /* Style for the buttons */
        .button-container button {
            padding: 10px 20px; /* Add padding to the buttons */
            margin: 5px; /* Add some margin between buttons */
            border: 1px solid #007BFF; /* Add a border with a blue color */
            background-color: #007BFF; /* Blue background */
            color: white; /* White text */
            font-size: 16px; /* Increase font size */
            cursor: pointer; /* Pointer cursor on hover */
            transition: background-color 0.3s, color 0.3s; /* Smooth background and text color transition */
        }

        .button-container button:hover {
            background-color: #0056b3; /* Darker blue on hover */
            color: #ffffff; /* Ensure text remains white on hover */
        }


        /* Tooltip arrow */
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%; /* At the bottom of the tooltip */
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }

        .fraction .denominator {
            /* margin-top: -5px; */
            margin-top: 0px; 
        }

    </style>
</head>

<body>
    <div class="container">
        <h1>Risk and Odds Ratio</h1>
        <h2>Study Data Entry</h2>
        <div class="input-section">
            <label for="disease">What outcome are you studying?</label>
            <input type="text" id="disease" placeholder="Enter outcome">
            <label for="exposure">What exposure are you studying?</label>
            <input type="text" id="exposure" placeholder="Enter exposure">
            <button id="enterData">Enter the data collected in the study</button>
        </div>
        <div class="table-section" style="display:none;">
            <p>Enter the numbers you have collected from your study in the table below. Note: you do not need to enter all numbers.
                Once you have entered the numbers you have, you can compute the remaining values. If you enter numbers that do not 
                add up correctly, we will highlight these inconsistencies for you.</p>

            <table>
                <thead>
                    <tr>
                        <th colspan="2" rowspan="2"></th>
                        <th colspan="2">Outcome Status</th>
                        <th rowspan="2">Row Total</th>
                    </tr>
                    <tr>
                        <th>Yes</th>
                        <th>No</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th rowspan="2">Exposure Status</th>
                        <th>Yes</th>
                        <td><input type="text" id="exposedDisease" placeholder="A = E+, O+"></td>
                        <td><input type="text" id="exposedNoDisease" placeholder="B = E+, O-"></td>
                        <td><input type="text" id="totalExposed" placeholder="E+ = A + B"></td>
                    </tr>
                    <tr>
                        <th>No</th>
                        <td><input type="text" id="notExposedDisease" placeholder="C = E-, O+"></td>
                        <td><input type="text" id="notExposedNoDisease" placeholder="D = E-, O-"></td>
                        <td><input type="text" id="totalNotExposed" placeholder="E- = C + D"></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="2">Column Total</th>
                        <td><input type="text" id="totalDisease" placeholder="O+ = A + C"></td>
                        <td><input type="text" id="totalNoDisease" placeholder="O- = B + D"></td>
                        <td><input type="text" id="totalSum" placeholder="N = ALL"></td>
                    </tr>
                </tfoot>
            </table>
            <div class="button-container">
                <button id="computeMissing">Compute Missing Numbers</button>
                <button id="validateButton">Validate Numbers</button>
                <button id="clearButton">Clear Table</button>
                <button id="computeRatiosButton">Compute Risks and Odds Ratios</button>
            </div>

        </div>
        <div id="ratiosSection" style="display: none;">
            <h3>Risk and Odds Ratio:</h3>
            <p>Risk Ratio: <span id="riskRatioDisplay">[Risk Ratio]</span></p>
            <p>Odds Ratio: <span id="oddsRatioDisplay" class="tooltip">[Odds Ratio]</span></p>
        </div>

        <div id="otherRisksSection" style="display: none;">
            <h3>Attributable Risk</h3>
            <p class="highlight"><b>Definition</b>: <span id="attrRiskDefn"></span></p>
        </div>

        <div id="PARSection" style="display: none;">
            <h3>Population Attributable Risk</h3>
            <p class="highlight"><b>Definition</b>: <span id="PARDefn"></span></p>
        </div>

        <div id="attrRiskInput" style="display: none;">
            <label for="multiplier">Calculating attributable risk requires a suitable multiplier. What is a suitable multiplier you want to use?</label><br>
            <input type="number" id="multiplier" value="100"><br><br>
            <button id="computeAttrRiskButton">Compute Attributable Risk and Population Attributable Risk</button>
        </div>

        <div id="attrRiskResult" style="display: none;">
            <h3>Attributable Risk</h3>
            <p><span id="attrRiskDisplay"></span></p>
        </div>

        <!-- <div id="PARInput" style="display: none;">
            <button id="computePAR">Compute Population Attributable Risk</button>
        </div> -->

        <div id="PARResult" style="display: none;">
            <h3>Population Attributable Risk</h3>
            <p><span id="PARDisplay"></span></p>
        </div>


    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        var origMessages = {
            "exposedDisease": "A = E+,O+",
            "exposedNoDisease": "B = E+, O-",
            "totalExposed": "E+ = A + B",
            "notExposedDisease": "C = E-, O+",
            "notExposedNoDisease": "D = E-, O-",
            "totalNotExposed": "E- = C + D",
            "totalDisease": "O+ = A + C",
            "totalNoDisease": "O- = B + D",
            "totalSum": "N = ALL"
        };

        var ids = ['#exposedDisease', '#exposedNoDisease', '#totalExposed', '#notExposedDisease', '#notExposedNoDisease', '#totalNotExposed', '#totalDisease', '#totalNoDisease', '#totalSum'];

        var colorError = 'rgb(255, 0, 0)';
        var colorComputed = 'rgb(212, 237, 218)'; 
        var colorMissing = 'rgb(248, 215, 218)';

        var tooltipTextOutcome = "this is the outcome you specified";
        var tooltipTextExposure = "this is the exposure you specified";
        var tooltipTextMultiplier = "this is the multiplier you specified";

        var riskRatio = 0;
        var formattedRiskRatio = 0;

        function displayRatiosError() {
            var message = 'Make sure there are no missing numbers in the table and the numbers add up before ratios can be computed.';
            $('#computeRatiosButton').attr('title', message);
        }

        function clearRatiosError() {
            $('#computeRatiosButton').removeAttr('title');
        }

        function updateTextBox(el, newVal, msg) {
            el.removeAttr('title');
            el.attr('title',msg);
            el.val(newVal).css('background-color', colorComputed);
        }

        function computeMissing() {
            $.each(ids, function(index, id) {
                if ($(id).css('background-color') && 
                        ($(id).css('background-color') === colorError || $(id).css('background-color') === colorComputed)) {
                    $(id).val(''); // Clear the value
                    $(id).attr('title',origMessages[$(id).attr('id')]);
                }
            });

            var exposedDisease = $('#exposedDisease').val() ? parseInt($('#exposedDisease').val()) : undefined;
            var exposedNoDisease = $('#exposedNoDisease').val() ? parseInt($('#exposedNoDisease').val()) : undefined;
            var notExposedDisease = $('#notExposedDisease').val() ? parseInt($('#notExposedDisease').val()) : undefined;
            var notExposedNoDisease = $('#notExposedNoDisease').val() ? parseInt($('#notExposedNoDisease').val()) : undefined;
            var totalExposed = $('#totalExposed').val() ? parseInt($('#totalExposed').val()) : undefined;
            var totalNotExposed = $('#totalNotExposed').val() ? parseInt($('#totalNotExposed').val()) : undefined;
            var totalDisease = $('#totalDisease').val() ? parseInt($('#totalDisease').val()) : undefined;
            var totalNoDisease = $('#totalNoDisease').val() ? parseInt($('#totalNoDisease').val()) : undefined;
            var totalSum = $('#totalSum').val() ? parseInt($('#totalSum').val()) : undefined;

            $.each(ids,function(index, id) {
                if ($(id).css('background-color') && $(id).css('background-color') === 'rgb(248, 215, 218)') {
                    $(id).css('background-color', '');
                }
            });

            var updatedVals = true;

            while (updatedVals) {
                // Compute and update missing values
                updatedVals = false;

                // E+ = A + B
                if (totalExposed === undefined && exposedDisease !== undefined && exposedNoDisease !== undefined) {
                    totalExposed = exposedDisease + exposedNoDisease;
                    updatedVals = true;
                    updateTextBox($('#totalExposed'), totalExposed, origMessages["totalExposed"] + ' ' +
                        'E+ computed as: ' + 'E+,O+ (' + exposedDisease + ') + E+,O- (' + exposedNoDisease + ').');
                }
                if (exposedDisease === undefined && totalExposed !== undefined && exposedNoDisease !== undefined) {
                    exposedDisease = totalExposed - exposedNoDisease;
                    updatedVals = true;
                    updateTextBox($('#exposedDisease'), exposedDisease, origMessages["exposedDisease"] + ' ' +
                        'E+,O+ computed as: ' + 'E+ (' + totalExposed + ') - E+,O- (' + exposedNoDisease + ').');
                }
                if (exposedNoDisease === undefined && totalExposed !== undefined && exposedDisease !== undefined) {
                    exposedNoDisease = totalExposed - exposedDisease;
                    updatedVals = true;
                    updateTextBox($('#exposedNoDisease'), exposedNoDisease, origMessages["exposedNoDisease"] + ' ' +
                        'E+,O- computed as: ' + 'E+ (' + totalExposed + ') - E+,O+ (' + exposedDisease + ').');
                }

                // E- = C + D
                if (totalNotExposed === undefined && notExposedDisease !== undefined && notExposedNoDisease !== undefined) {
                    totalNotExposed = notExposedDisease + notExposedNoDisease;
                    updatedVals = true;
                    updateTextBox($('#totalNotExposed'), totalNotExposed, origMessages["totalNotExposed"] + ' ' +
                        'E- computed as: ' + 'E-,O+ (' + notExposedDisease + ') + E-,O- (' + notExposedNoDisease + ').');
                }
                if (notExposedDisease === undefined && totalNotExposed !== undefined && notExposedNoDisease !== undefined) {
                    notExposedDisease = totalNotExposed - notExposedNoDisease;
                    updatedVals = true;
                    updateTextBox($('#notExposedDisease'), notExposedDisease, origMessages["notExposedDisease"] + ' ' +
                        'E-,O+ computed as: ' + 'E- (' + totalNotExposed + ') - E-,O- (' + notExposedNoDisease + ').');
                }
                if (notExposedNoDisease === undefined && totalNotExposed !== undefined && notExposedDisease !== undefined) {
                    notExposedNoDisease = totalNotExposed - notExposedDisease;
                    updatedVals = true;
                    updateTextBox($('#notExposedNoDisease'), notExposedNoDisease, origMessages["notExposedNoDisease"] + ' ' +
                        'E-,O- computed as: ' + 'E- (' + totalNotExposed + ') - E-,O+ (' + notExposedDisease + ').');
                }

                // O+ = A + C
                if (totalDisease === undefined && exposedDisease !== undefined && notExposedDisease !== undefined) {
                    totalDisease = exposedDisease + notExposedDisease;
                    updatedVals = true;
                    updateTextBox($('#totalDisease'), totalDisease, origMessages["totalDisease"] + ' ' +
                        'O+ computed as: ' + 'E+,O+ (' + exposedDisease + ') + E-,O+ (' + notExposedDisease + ').');
                }
                if (exposedDisease === undefined && totalDisease !== undefined && exposedDisease !== undefined) {
                    exposedDisease = totalDisease - notExposedDisease;
                    updatedVals = true;
                    updateTextBox($('#exposedDisease'), exposedDisease, origMessages["exposedDisease"] + ' ' +
                        'E+,O+ computed as: ' + 'O+ (' + totalDisease + ') - E-,O+ (' + notExposedDisease + ').');
                }
                if (notExposedDisease === undefined && totalDisease !== undefined && exposedDisease !== undefined) {
                    notExposedDisease = totalDisease - exposedDisease;
                    updatedVals = true;
                    updateTextBox($('#notExposedDisease'), notExposedDisease, origMessages["notExposedDisease"] + ' ' +
                        'E-,O+ computed as: ' + 'O+ (' + totalDisease + ') - E+,O+ (' + exposedDisease + ').');
                }

                // O- = B + D
                if (totalNoDisease === undefined && exposedNoDisease !== undefined && notExposedNoDisease !== undefined) {
                    totalNoDisease = exposedNoDisease + notExposedNoDisease;
                    updatedVals = true;
                    updateTextBox($('#totalNoDisease'), totalNoDisease, origMessages["totalNoDisease"] + ' ' +
                        'O- computed as: ' + 'E+,O- (' + exposedNoDisease + ') + E-,O- (' + notExposedNoDisease + ').');
                }
                if (exposedNoDisease === undefined && totalNoDisease !== undefined && notExposedNoDisease !== undefined) {
                    exposedNoDisease = totalNoDisease - notExposedNoDisease;
                    updatedVals = true;
                    updateTextBox($('#exposedNoDisease'), exposedNoDisease, origMessages["exposedNoDisease"] + ' ' +
                        'E+,O- computed as: ' + 'O- (' + totalNoDisease + ') - E-,O- (' + notExposedNoDisease + ').');
                }
                if (notExposedNoDisease === undefined && totalNoDisease !== undefined && exposedNoDisease !== undefined) {
                    notExposedNoDisease = totalNoDisease - exposedNoDisease;
                    updatedVals = true;
                    updateTextBox($('#notExposedNoDisease'), notExposedNoDisease, origMessages["notExposedNoDisease"] + ' ' +
                        'E-,O- computed as: ' + 'O- (' + totalNoDisease + ') - E+,O- (' + exposedNoDisease + ').');
                }

                // N = E+ + E-
                if (totalSum === undefined && totalExposed !== undefined && totalNotExposed !== undefined) {
                    totalSum = totalExposed + totalNotExposed;
                    updatedVals = true;
                    updateTextBox($('#totalSum'), totalSum, origMessages["totalSum"] + ' ' +
                        'N computed as: ' + 'E+ (' + totalExposed + ') + E- (' + totalNotExposed + ').');
                }
                if (totalExposed === undefined && totalSum !== undefined && totalNotExposed !== undefined) {
                    totalExposed = totalSum - totalNotExposed;
                    updatedVals = true;
                    updateTextBox($('#totalExposed'), totalExposed, origMessages["totalExposed"] + ' ' +
                        'E+ computed as: ' + 'N (' + totalSum + ') - E- (' + totalNotExposed + ').');
                }
                if (totalNotExposed === undefined && totalSum !== undefined && totalExposed !== undefined) {
                    totalNotExposed = totalSum - totalExposed;
                    updatedVals = true;
                    updateTextBox($('#totalNotExposed'), totalNotExposed, origMessages["totalNotExposed"] + ' ' +
                        'E- computed as: ' + 'N (' + totalSum + ') - E+ (' + totalExposed + ').');
                }

                // N = O+ + O-
                if (totalSum === undefined && totalDisease !== undefined && totalNoDisease !== undefined) {
                    totalSum = totalDisease + totalNoDisease;
                    updatedVals = true;
                    updateTextBox($('#totalSum'), totalSum, origMessages["totalSum"] + ' ' +
                        'N computed as: ' + 'O+ (' + totalDisease + ') + O- (' + totalNoDisease + ').');
                }
                if (totalDisease === undefined && totalSum !== undefined && totalNoDisease !== undefined) {
                    totalDisease = totalSum - totalNoDisease;
                    updatedVals = true;
                    updateTextBox($('#totalDisease'), totalDisease, origMessages["totalDisease"] + ' ' +
                        'O+ computed as: ' + 'N (' + totalSum + ') - O- (' + totalNoDisease + ').');
                }
                if (totalNoDisease === undefined && totalSum !== undefined && totalDisease !== undefined) {
                    totalNoDisease = totalSum - totalDisease;
                    updatedVals = true;
                    updateTextBox($('#totalNoDisease'), totalNoDisease, origMessages["totalNoDisease"] + ' ' +
                        'O- computed as: ' + 'N (' + totalSum + ') - O+ (' + totalDisease + ').');
                }
            }

            $(ids).each(function(index, id) {
                if (!$(id).val()) {
                    $(id).css('background-color', colorMissing);
                }
            });

            if (!validateNumbers()) {
                displayRatiosError();
            } else {
                clearRatiosError();
            }

        }

        function checkValid(id1, id2, id3, msg) {
            var val1 = $(id1).val() ? parseInt($(id1).val()) : undefined;
            var val2 = $(id2).val() ? parseInt($(id2).val()) : undefined;
            var val3 = $(id3).val() ? parseInt($(id3).val()) : undefined;

            if (val1 !== undefined && val2 !== undefined && val3 !== undefined) {
                if (val1 + val2 !== val3) {
                    $(id3).css('background-color', colorError);
                    $(id3).attr('title', msg);
                    return false;
                }
                else return true;
            }
            return false;
        }

        function validateNumbers() {

            var validFlag = true;

            // Check negative values
            $.each(ids, function(index, id) {
                var value = $(id).val() ? parseInt($(id).val()) : undefined;
                if (value !== undefined && value < 0) {
                    $(id).css('background-color', 'red');
                    var originalTitle = origMessages[$(id).attr('id')];
                    $(id).attr('title', originalTitle + ' Value cannot be negative');
                    validFlag = false;
                }
            });

            // E+ = A + B
            if (!checkValid(ids[0], ids[1], ids[2],
                origMessages["totalExposed"] + ' E+,O+ and E+,O- must add to E+, but your numbers do not add up.'))
                validFlag = false;

            // E- = C + D
            if (!checkValid(ids[3], ids[4], ids[5],
                origMessages["totalNotExposed"] + ' E-,O+ and E-,O- must add to E-, but your numbers do not add up.'))
                validFlag = false;

            // O+ = A + C
            if (!checkValid(ids[0], ids[3], ids[6],
                origMessages["totalDisease"] + ' E+,O+ and E-,O+ must add to O+, but your numbers do not add up.'))
                validFlag = false;

            // O- = B + D
            if (!checkValid(ids[1], ids[4], ids[7],
                origMessages["totalNoDisease"] + ' E+,O- and E-,O- must add to O-, but your numbers do not add up.'))
                validFlag = false;

            // N = E+ + E-
            if (!checkValid(ids[2], ids[5], ids[8],
                origMessages["totalSum"] + ' E+ and E- must add to N, but your numbers do not add up.'))
                validFlag = false;

            // N = O+ + O-
            if (!checkValid(ids[6], ids[7], ids[8],
                origMessages["totalSum"] + ' O+ and O- must add to N, but your numbers do not add up.'))
                validFlag = false;

            if (!validFlag) {
                displayRatiosError();
            } else {
                clearRatiosError();
            }

            return validFlag;
        }

        function computeRatios() {
            // Parse the values from the textboxes
            var exposedDisease = $('#exposedDisease').val() ? parseInt($('#exposedDisease').val()) : 0;
            var totalExposed = $('#totalExposed').val() ? parseInt($('#totalExposed').val()) : 0;
            var notExposedDisease = $('#notExposedDisease').val() ? parseInt($('#notExposedDisease').val()) : 0;
            var totalNotExposed = $('#totalNotExposed').val() ? parseInt($('#totalNotExposed').val()) : 0;
            var exposedNoDisease = $('#exposedNoDisease').val() ? parseInt($('#exposedNoDisease').val()) : 0;
            var notExposedNoDisease = $('#notExposedNoDisease').val() ? parseInt($('#notExposedNoDisease').val()) : 0;
            var exposure = $('#exposure').val();
            var disease = $('#disease').val();

            var exposureMsg = `<span class="tooltip">${exposure}<span class="tooltiptext" style="width: 250px;">${tooltipTextExposure}</span></span>`;
            var outcomeMsg = `<span class="tooltip">${disease}<span class="tooltiptext" style="width: 250px;">${tooltipTextOutcome}</span></span>`;

            // Calculate the Risk Ratio
            var riskExposed = totalExposed !== 0 ? exposedDisease / totalExposed : 0;
            var riskNotExposed = totalNotExposed !== 0 ? notExposedDisease / totalNotExposed : 0;
            riskRatio = riskNotExposed !== 0 ? riskExposed / riskNotExposed : 0;

            // Format the Risk Ratio to 2 decimal places, showing only necessary decimal places
            formattedRiskRatio = riskRatio.toFixed(2).replace(/\.?0+$/, '');

            // Set up the tooltip
            var tooltipText = `Calculated as: <br>
            <span class="fraction"><span class="numerator">E+,O+/E+</span> <span class="denominator">E-,O+/E-</span></span> = 
            <span class="fraction"><span class="numerator">${exposedDisease}/${totalExposed}</span> 
            <span class="denominator">${notExposedDisease}/${totalNotExposed}</span></span> = ${formattedRiskRatio}`;
            $('#riskRatioDisplay').text("");

            // Display the message
            var message = `Those exposed to ${exposureMsg} have `;
            message += `<span class="tooltip">${formattedRiskRatio}<span class="tooltiptext" style="width: 300px;">${tooltipText}</span></span>`;
            message += `x the risk when compared to those not exposed to ${exposureMsg} for developing ${outcomeMsg}`;
            // $('#riskRatioDisplay').text(message);

            if (riskRatio != 1) {   // Display only if ratio is not 1
                $('#riskRatioDisplay').html(message);
            }

            // Calculate the additional risk message
            var additionalRisk;
            var addlRiskMsg = "";          
            if (riskRatio > 1) {
                var addlRisk = Math.round((formattedRiskRatio - 1) * 100);
                tooltipText = `Calculated as:<br>(Risk Ratio - 1) * 100 = (${formattedRiskRatio} - 1) * 100 = ${addlRisk}`;
                addlRiskMsg = `Can also be said as: Those exposed to ${exposureMsg} have `;
                addlRiskMsg += `<span class="tooltip">${addlRisk}<span class="tooltiptext" style="width: 325px;">${tooltipText}</span></span>`;
                addlRiskMsg += `% higher risk than those not exposed to ${exposureMsg} for developing ${outcomeMsg}.`;
            } else if (riskRatio === 1) {
                addlRiskMsg = `Exposure to ${exposureMsg} has no association with developing ${outcomeMsg}.`;
            } else {
                var addlRisk = (1 - formattedRiskRatio) * 100;
                tooltipText = `Calculated as:<br>(1 - Risk Ratio) * 100 = (1 - ${formattedRiskRatio}) * 100 = ${addlRisk}`;
                addlRiskMsg = `Can also be said as: Those exposed to ${exposureMsg} have `;
                addlRiskMsg += `<span class="tooltip">${addlRisk}<span class="tooltiptext" style="width: 325px;">${tooltipText}</span></span>`;
                addlRiskMsg += `% lower risk than those not exposed to ${exposureMsg} for developing ${outcomeMsg}.`;
            }

            // Append the additional message on a new line. Display for all ratios
            $('#riskRatioDisplay').append(`<br/>${addlRiskMsg}`);

            // Calculate the Odds Ratio
            var oddsPositive = notExposedDisease !== 0 ? exposedDisease / notExposedDisease : 0;
            var oddsNegative = notExposedNoDisease !== 0 ? exposedNoDisease / notExposedNoDisease : 0;
            var oddsRatio = oddsNegative !== 0 ? oddsPositive / oddsNegative : 0;

            // Format the Odds Ratio to 2 decimal places, showing only necessary decimal places
            var formattedOddsRatio = oddsRatio.toFixed(2).replace(/\.?0+$/, '');

            // Display the message
            message = `The odds of being exposed to ${exposure} are ${formattedOddsRatio}-fold higher in those with ${disease} compared to those without ${disease}.`;
            $('#oddsRatioDisplay').text(message);

            // Set up the tooltip
            tooltipText = `Calculated as:<br>
            <span class="fraction"><span class="numerator">E+,O+/E-,O+</span> <span class="denominator">E+,O-/E-,O-</span></span> = 
            <span class="fraction"><span class="numerator">${exposedDisease}/${notExposedDisease}</span> 
            <span class="denominator">${exposedNoDisease}/${notExposedNoDisease}</span></span> = ${formattedOddsRatio}`;
            $('#oddsRatioDisplay').text(message);
            $('#oddsRatioDisplay').append(`<span class="tooltiptext" style="width: 300px;">${tooltipText}</span>`);
            
            // Display the section
            $('#ratiosSection').show();

            // Display attributable risk section if appropriate
            var tooltipText1 = "this is the outcome you specified";
            var tooltipText2 = "this is the exposure you specified";
            message = `Attributable Risk is the number of cases of the outcome attributed to the exposure.<br><br>`;
            message += `Attributable Risk is calculated as:<br>Incidence Proportion (Cumulative Incidence) of ${outcomeMsg} `;
            message += `in those exposed to ${exposureMsg} &minus; `;
            message += `Incidence Proportion (Cumulative Incidence) of ${outcomeMsg} in those not exposed to ${exposureMsg}`;
            $('#attrRiskDefn').html(message);
            // if (riskRatio > 1) $('#otherRisksSection').show();

            /* prevExposure = totalExposed/totalNotExposed;
            // Format the exposure prevalence to 2 decimal places, showing only necessary decimal places
            var formattedprevExposure = prevExposure.toFixed(2).replace(/\.?0+$/, '');

            tooltipText = `Calculated as: 
            <span class="fraction"><span class="numerator">E+</span> <span class="denominator">E-</span></span> = 
            <span class="fraction"><span class="numerator">${totalExposed}/${totalNotExposed}</span> = ${formattedprevExposure}`;

            var prevExposureMsg = `<span class="tooltip">prevalence of exposure<span class="tooltiptext" style="width: 300px;">${tooltipText}</span></span>`;

            message = `Population Attributable Risk (PAR) % is the percentage of disease cases attributed to the exposure within the overall population.<br>`;
            message += `PAR takes into account both the ${prevExposureMsg} and its strength of association with ${outcomeMsg}`; */

            message = `Population Attributable Risk (PAR) % is the percentage of cases with ${outcomeMsg} attributed to ${exposureMsg} within the overall population.<br>`;
            message += `PAR takes into account both the prevalence of exposure and its strength of association with ${outcomeMsg}`;

            $('#PARDefn').html(message);
            // if (riskRatio > 1) $('#PARSection').show();
            if (riskRatio > 1) {
                $('#otherRisksSection').show();
                $('#PARSection').show();
                $('#attrRiskInput').show();
                // $('#PARInput').show();
            }
        }

        $(document).ready(function () {
        });

        $('#enterData').click(function () {
            var disease = $('#disease').val() || $('#disease').val('Outcome O').val();
            var exposure = $('#exposure').val() || $('#exposure').val('Exposure E').val();

            origMessages["exposedDisease"] = 'A = E+, O+. Of the people exposed to ' + $('#exposure').val() + ' in your study, how many developed ' + $('#disease').val() + '?';
            origMessages["exposedNoDisease"] = 'B = E+, O-. Of the people exposed to ' + $('#exposure').val() + ' in your study, how many did not develop ' + $('#disease').val() + '?';
            origMessages["totalExposed"] = 'E+ = A + B. What is the total number of people exposed to ' + $('#exposure').val() + ' in your study?';

            origMessages["notExposedDisease"] = 'C = E-, O+. Of the people not exposed to ' + $('#exposure').val() + ' in your study, how many developed ' + $('#disease').val() + '?';
            origMessages["notExposedNoDisease"] = 'D = E-, O-. Of the people not exposed to ' + $('#exposure').val() + ' in your study, how many did not develop ' + $('#disease').val() + '?';
            origMessages["totalNotExposed"] = 'E- = C + D. What is the total number of people not exposed to ' + $('#exposure').val() + ' in your study?';

            origMessages["totalDisease"] = 'O+ = A + C. What is the total number of people who developed ' + $('#disease').val() + ' in your study?';
            origMessages["totalNoDisease"] = 'O- = B + D. What is the total number of people who did not develop ' + $('#disease').val() + ' in your study?';
            origMessages["totalSum"] = 'N = ALL. What is the total number of people in your study?';

            $('#exposedDisease').attr('title',origMessages["exposedDisease"]);
            $('#exposedNoDisease').attr('title',origMessages["exposedNoDisease"]);
            $('#totalExposed').attr('title',origMessages["totalExposed"]);

            $('#notExposedDisease').attr('title',origMessages["notExposedDisease"]);
            $('#notExposedNoDisease').attr('title',origMessages["notExposedNoDisease"]);
            $('#totalNotExposed').attr('title',origMessages["totalNotExposed"]);

            $('#totalDisease').attr('title',origMessages["totalDisease"]);
            $('#totalNoDisease').attr('title',origMessages["totalNoDisease"]);
            $('#totalSum').attr('title',origMessages["totalSum"]);

            $('.table-section').show();
            displayRatiosError();
        });

        $('#computeMissing').click(function() {
            computeMissing();
        });

        $('#clearButton').click(function() {
            // Clear values and reset background color for each textbox
            $(ids).each(function(index, id) {
                $(id).val('').css('background-color', '');
                $(id).attr('title',origMessages[$(id).attr('id')]);
            });

            $('#ratiosSection').hide();
            // $('#otherRisksSection').hide();
            // $('#attrRiskResult').hide();
            $('#attrRiskInput').hide();
            $('#attrRiskResult').hide();
            // $('#PARInput').hide();
            $('#PARResult').hide();

        });

        $('#validateButton').click(function() {
            computeMissing();
            validateNumbers();
        });

        $('#computeRatiosButton').click(function() {
            computeMissing();
            if (!validateNumbers()) {
                displayRatiosError();
            } else {
                clearRatiosError();
                computeRatios();
            }
        });

        $('#computeAttrRiskButton').click(function() {
            // Parse the values from the textboxes
            var exposedDisease = $('#exposedDisease').val() ? parseInt($('#exposedDisease').val()) : 0;
            var totalExposed = $('#totalExposed').val() ? parseInt($('#totalExposed').val()) : 0;
            var notExposedDisease = $('#notExposedDisease').val() ? parseInt($('#notExposedDisease').val()) : 0;
            var totalNotExposed = $('#totalNotExposed').val() ? parseInt($('#totalNotExposed').val()) : 0;
            var exposedNoDisease = $('#exposedNoDisease').val() ? parseInt($('#exposedNoDisease').val()) : 0;
            var notExposedNoDisease = $('#notExposedNoDisease').val() ? parseInt($('#notExposedNoDisease').val()) : 0;
            var totalSum = $('#totalSum').val() ? parseInt($('#totalSum').val()) : 0;

            var exposure = $('#exposure').val();
            var disease = $('#disease').val();
            var multiplier = $('#multiplier').val() ? parseInt($('#multiplier').val()) : 0;

            var incidenceExposed = exposedDisease/totalExposed * multiplier;
            var incidenceNotExposed = notExposedDisease/totalNotExposed * multiplier;
            var attrRisk = incidenceExposed - incidenceNotExposed;

            // Format the Numbers to 2 decimal places, showing only necessary decimal places
            var formattedincidenceExposed = incidenceExposed.toFixed(2).replace(/\.?0+$/, '');
            var formattedincidenceNotExposed = incidenceNotExposed.toFixed(2).replace(/\.?0+$/, '');
            var formattedattrRisk = formattedincidenceExposed - formattedincidenceNotExposed;

            var attrRisk2 = formattedattrRisk/formattedincidenceExposed * 100;
            var formattedattrRisk2 = attrRisk2.toFixed(2).replace(/\.?0+$/, '');

            var exposureMsg = `<span class="tooltip">${exposure}<span class="tooltiptext" style="width: 250px;">${tooltipTextExposure}</span></span>`;
            var outcomeMsg = `<span class="tooltip">${disease}<span class="tooltiptext" style="width: 250px;">${tooltipTextOutcome}</span></span>`;
            var multiplierMsg = `<span class="tooltip">${multiplier}<span class="tooltiptext" style="width: 250px;">${tooltipTextMultiplier}</span></span>`;

            var tooltipText4 = "calculated as:<br> Incidence Proportion in Exposed ";
            tooltipText4 += `(<span class="fraction"><span class="numerator">${exposedDisease}</span><span class="denominator">${totalExposed}</span></span> `;
            tooltipText4 += `&times; ${multiplier}) &minus; <br>`;
            tooltipText4 += `Incidence Proportion in Not Exposed (<span class="fraction"><span class="numerator">${notExposedDisease}</span><span class="denominator">${totalNotExposed}</span></span> `;
            tooltipText4 += `&times; ${multiplier})<br>`;
            tooltipText4 += `= (${formattedincidenceExposed} &minus; ${formattedincidenceNotExposed}) = ${formattedattrRisk}`;

            var tooltipText5 = `calculated as: <span class="fraction"><span class="numerator">(Incidence Proportion in Exposed &minus; Incidence Proportion in Not Exposed)</span><span class="denominator">Incidence Proportion in Exposed</span></span>`;
            tooltipText5 += " &times; 100<br>";
            tooltipText5 += `= <span class="fraction"><span class="numerator">(${formattedincidenceExposed} &minus; ${formattedincidenceNotExposed})</span><span class="denominator">${formattedincidenceExposed}</span></span>`;
            tooltipText5 += ` &times; 100 = ${formattedattrRisk2}`;

            message = `The excess risk of ${outcomeMsg} among those exposed to ${exposureMsg} attributable to ${exposureMsg} is `;
            message += `<span class="tooltip">${formattedattrRisk}<span class="tooltiptext" style="width: 450px;">${tooltipText4}</span></span> `;
            message += `per ${multiplierMsg} population.<br>`;
            message += `Can also be said as: Among those exposed to ${exposureMsg}, `;
            message += `<span class="tooltip">${formattedattrRisk2}<span class="tooltiptext" style="width: 600px;">${tooltipText5}</span></span>`;
            message += `% of cases with ${outcomeMsg} is attributed to ${exposureMsg} and could be prevented if ${exposureMsg} was controlled.`;

            $('#attrRiskDisplay').html(message);

            var prevE = totalExposed/totalSum * 100;
            var formattedPrevE = prevE.toFixed(2).replace(/\.?0+$/, '');

            var tooltipText5 = `calculated as:<br>`;
            tooltipText5 += `<span class="fraction"><span class="numerator">Number of people exposed to ${exposure} (${totalExposed})</span>`;
            tooltipText5 += `<span class="denominator">Number of people in the study (${totalSum})</span></span>`;
            tooltipText5 += `&times; multiplier (100)`;
            message = `Prevalence of ${exposureMsg} = `;
            message += `<span class="tooltip">${formattedPrevE}<span class="tooltiptext" style="width: 500px;">${tooltipText5}</span></span>%`;

            var formattedPrevE1 = formattedPrevE/100;
            var par = formattedPrevE1 * (riskRatio - 1)/(formattedPrevE1 * (riskRatio - 1) + 1) * 100;
            var formattedPar = par.toFixed(2).replace(/\.?0+$/, '');

            var tooltipText6 = `calculated as:<br>`;
            tooltipText6 += `<span class="fraction"><span class="numerator">Prevalence of ${exposure} (${formattedPrevE1}) * [Risk Ratio (${formattedRiskRatio}) - 1]</span>`;
            tooltipText6 += `<span class="denominator">Prevalence of ${exposure} (${formattedPrevE1}) * [Risk Ratio (${formattedRiskRatio}) - 1] + 1</span></span>`;

            message += `<br><br>In the overall population, `;
            message += `<span class="tooltip">${formattedPar}<span class="tooltiptext" style="width: 600px;">${tooltipText6}</span></span>% `;
            message += `of cases with ${outcomeMsg} is attributed to ${exposureMsg} `;
            message += `and could be prevented if ${exposureMsg} was controlled.`;
            $('#PARDisplay').html(message);

            $('#attrRiskResult').show();
            $('#PARResult').show();
        });


    </script>
</body>

</html>